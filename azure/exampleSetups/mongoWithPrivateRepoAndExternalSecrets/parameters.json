{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "vmSuffix": {
      "value": "podMongoTest"
    },
    "cloudInit": {
      "value" : "#cloud-config\npackage_upgrade: true\npackages:\n  - apt-transport-https\n  - ca-certificates\n  - curl\n  - gnupg-agent\n  - software-properties-common\n  - npm\n\n#Public key for github.com \n#Generate with ssh-keyscan github.com >> github.com.pub\n#Check fingerprint with ssh-keygen -lf github.com.pub\n#Compare fingerprint against the fingerprint posted on github.com\nwrite_files:\n  - content: |\n      github.com ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAq2A7hRGmdnm9tUDbO9IDSwBK6TbQa+PXYPCPy6rbTrTtw7PHkccKrpp0yVhp5HdEIcKr6pLlVDBfOLX9QUsyCOV0wzfjIJNlGEYsdlLJizHhbn2mUjvSAHQqZETYP81eFzLQNnPHt4EVVUh7VfDESU84KezmD5QlWpXLmvU31/yMf+Se8xhHTvKSCZIFImWwoG6mbUoWf9nzpIoaSjB+weqqUUmpaaasXVal72J+UX2B+2RPW3RcT0eOzQgqlJL3RKrTJvdsjE3JEAvGq3lGHSZXy28G3skua2SmVi/w4yCE6gbODqnTWlg7+wC604ydGXA8VJiS5ap43JXiUFFAaQ==\n    path: /etc/ssh/ssh_known_hosts\n    \n#Git repo deployment key and public key \nssh_keys:\n  rsa_private: |\n    -----BEGIN RSA PRIVATE KEY-----\n    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\n    -----END RSA PRIVATE KEY-----\n  rsa_public: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDQBILkZ5XEHdqdVYaqlz0arFwwOWOU5X/o1cetqnHj6w3e790PlDPouyxFvl8mhHX3ddEUUkq4WksAjd59giS4Tr3EKgXT0kLILtppCkJfDhHpDLIYb7yHzrEAH8HL87jlAhCwtXIb2/9T/QDqumUTEh1wV0iGMA238caIenbWNjHTDuwVUPv7tUNcdTFwseXu0pblU9GNwb2QO3zyLB6oMiXHjvvZ0ErtHzb9VkjEnI6QRoEuDuCJJIGrPLqGQDuW2RHIHFnlccL0X3OQY/Ud/Pyy/wt2KX+dcQxKI63S4n9CXJL214mrlyUTz+aYJf1V7bjLt9MeDwDaMlfKPvjlSi7S/ICc4KvgbGz8rtE5GrmMAQkcQEiAzPG76Mhj21R/EfHbISNG+amJYkq1LWaLlclbo+zpwSNUKRE/WEZcwiCP2dgm9tn/tdKwD4TG29O0VQTE74Syu4gu3lSDTRJ6jlg8/eDkW0/AcYYn1Oe5GLJbVlPz+oIigrN7XWjRy+8= main@JG-ARCH\n    \nruncmd:\n    # Setting up Node\n  - curl -sL \"https://deb.nodesource.com/setup_14.x\" | sudo -E bash -\n  - apt-get install -y nodejs\n    #Setting up mongodb\n  - curl -fsSL https://www.mongodb.org/static/pgp/server-4.4.asc -o /key.txt\n  - apt-key add /key.txt\n  - rm /key.txt\n  - add-apt-repository \"deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.4 multiverse\"\n  - apt-get update -y\n  - apt-get install -y mongodb-org\n  - systemctl start mongod\n  - systemctl enable mongod\n    # Installing chrome stable\n  - curl -fsSL https://dl.google.com/linux/linux_signing_key.pub -o /key.txt\n  - apt-key add /key.txt\n  - rm /key.txt\n  - >-\n    echo \"deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main\" >> /etc/apt/sources.list.d/google.list\n  - apt-get update -y\n  - apt-get install google-chrome-stable\n    #Adding ssh key to host keys\n  - eval \"$(ssh-agent -s)\"\n  - ssh-add /etc/ssh/ssh_host_rsa_key\n    #Pulling repo\n  - git clone git@github.com:JoaquimXG/podcolours.co.uk.git app\n  - cd app\n    #Pulling secrets file (Stored in Azure)\n  - curl \"https://xjgpersonalstorage.blob.core.windows.net/envvars/.env?sp=r&st=2021-09-23T14:11:22Z&se=2021-09-23T22:11:22Z&spr=https&sv=2020-08-04&sr=b&sig=M7T4jEfPFVwPKvhCM4dBdXvkmYgypC73gpIOsHG0XCg%3D\" -o .env\n    # Creating Mongo Admin User\n  - chmod +x ./createMongoUsers.sh\n  - bash createMongoUsers.sh\n    # Enabling Mongo Access Controls\n  - >-\n    echo \"security:\" >> /etc/mongod.conf\n  - >-\n    echo \"  authorization: enabled\" >> /etc/mongod.conf\n  - systemctl restart mongod\n    # Install app dependancies\n  - npm ci --production\n    # Setup Datbase from template\n  - npm run setupDb\n  - npm start\n\nfinal_message: \"The system is finally up, after $UPTIME seconds\"\n"
    }
  }
}
